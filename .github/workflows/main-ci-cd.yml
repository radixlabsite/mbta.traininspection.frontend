# .github/workflows/main-ci-cd.yml
name: CI/CD - Frontend Applications

on:
  workflow_dispatch: {}
  push:
    branches:
      - develop
      - main

jobs:
  # Job para o ambiente de Desenvolvimento
  run-dev-workflow:
    # Só executa em push para o branch 'develop'
    if: github.ref == 'refs/heads/develop'
    name: 🚀 Deploy to Development
    uses: ./.github/workflows/reusable-build-deploy.yml
    with:
      # Passa o nome do ambiente para o workflow reutilizável
      environment-name: dev
    secrets:
      # Passa o secret do ambiente de 'dev' para o workflow reutilizável
      # Este secret deve ser configurado no ambiente 'dev' do repositório
      AWS_ROLE_TO_ASSUME: ${{ secrets.AWS_ROLE_TO_ASSUME_DEV }}

  # Job para o ambiente de Produção
  run-prd-workflow:
    # Só executa em push para o branch 'main'
    if: github.ref == 'refs/heads/main'
    name: 🚀 Deploy to Production
    # Adiciona um passo de aprovação manual para deploys em produção
    environment: production
    uses: ./.github/workflows/reusable-build-deploy.yml
    with:
      # Passa o nome do ambiente 'prd'
      environment-name: prd
    secrets:
      # Passa o secret do ambiente de 'prd'
      # Este secret deve ser configurado no ambiente 'prd' do repositório
      AWS_ROLE_TO_ASSUME: ${{ secrets.AWS_ROLE_TO_ASSUME_PRD }}

