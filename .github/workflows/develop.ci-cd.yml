name: ‚öôÔ∏è CI/CD - Frontend Applications Development

on:
  workflow_dispatch: {}
  push:
    branches:
      - develop
      

permissions:
  id-token: write # Required for OIDC
  contents: read

jobs:

  # JOB 1: New security scan job that runs first
  security-scan:
    name: üõ°Ô∏è Scan Code with Trivy
    # This calls your new reusable workflow
    uses: ./.github/workflows/reusable-trivy-scan.yml
    with:
      # You can customize the inputs here if needed
      severity: 'HIGH,CRITICAL'
      security-checks: 'vuln,secret'

  # Job para o ambiente de Desenvolvimento
  run-dev-workflow:
    needs: security-scan
    if: github.ref == 'refs/heads/develop'
    name: üöÄ Deploy to Development
    uses: ./.github/workflows/reusable-build-deploy.yml
    with:
      environment-name: dev
    secrets:
      AWS_ROLE_TO_ASSUME: ${{ secrets.AWS_ROLE_TO_ASSUME_DEV }}
